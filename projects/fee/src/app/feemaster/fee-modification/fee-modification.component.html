<div>
  <div class="row">
    <div class="col-12 ">
      <mat-card class="card-top-title__container">
        <div class="row">
          <div class="col-6">
            <h1 class="remove-bottom-margin font-size-24">Fee Receipt Modification</h1>
          </div>
          <!-- <div class="col-6 text-right">
            <div class="vertical-align-sub inline-flex">
              <h3 class="font-size-15 margin-top-2 remove-bottom-margin">Bulk</h3>
              <mat-slide-toggle checked="false" (change)="gotoIndividual($event)" class="btn-spacer my-toggle"></mat-slide-toggle>
              <h3 class="font-size-15 margin-top-2 remove-bottom-margin btn-spacer">Individual</h3>
            </div>
          </div> -->
        </div>
      </mat-card>
    </div>
  </div>
  <div class="row">
    <div class="col-12 remove-col-padding">

    </div>
  </div>
  <form [formGroup]="modifyReceiptForm">
    <div class="row margin-top-25" style="margin-top: 0px !important">
      <div class="col-6 ">
        <mat-card class="card-top-form__container card-height-605 card-height-720">
          <div class="row">
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Invoice No.</mat-label>
                    <input matInput #inv placeholder="Invoice No." id="inv_num" type="number"
                      formControlName="inv_invoice_no" (keydown.enter)="getReceipt(inv.value, 'invoice')">
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Receipt No.</mat-label>
                    <input matInput #rpt placeholder="Receipt No." id="rpt_num" type="number"
                      formControlName="inv_receipt_no" (keydown.enter)="getReceipt(rpt.value, 'receipt')">
                  </mat-form-field>
                </div>
              </div>
            </div>
            <fieldset class="col-12 fieldset_invoice" *ngIf="receiptArray.length > 0">
              <div class="row margin-top-0 remove-padding">
                <legend class="invoice_legend">Receipt Details</legend>
                <div class="col-6 border_right">
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Admission No.</div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.au_admission_no}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Student Name</div>
                    <div class="font-size-16 font-bold  col-sm">
                      : {{receipt.au_full_name | capitalize}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Class</div>
                    <div class="font-size-16 font-bold  col-sm">
                      : {{class_sec}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Invoice No.</div>
                    <div class="font-size-16 font-bold col-sm">
                      : <a style="cursor: pointer;" class="font-skyblue font-underline"
                        (click)="openDialog(receipt.inv_invoice_no, false)"> {{receipt.inv_invoice_no}}
                      </a>
                    </div>
                  </div>

                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Fee Period: </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.fp_months}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Invoice Date: </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.inv_invoice_date | date: 'd-MMM-y'}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Invoice Due Date </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.inv_due_date | date: 'd-MMM-y'}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Previous Balance </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{ (receipt.fin_prev_balance ? (receipt.fin_prev_balance | number): 0) }}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Fine & Penalties: </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.rpt_fine_amount ? (receipt.rpt_fine_amount | number): 0}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Invoice Amount </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.inv_fee_amount | number}}
                    </div>
                  </div>

                </div>
                <div class="col-6">
                  <div class="row">

                    <div class="font-size-16 font-regular col-sm">Receipt No</div>
                    <div class="font-size-16 font-bold  col-sm">
                      : <a style="cursor: pointer;" class="font-skyblue font-underline"
                        (click)="openReceiptDialog(receipt.receipt_id, false)">
                        {{receipt.rpt_receipt_no}}
                      </a>
                    </div>
                  </div>
                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Receipt Date </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.rpt_receipt_date | date: 'd-MMM-y'}}
                    </div>
                  </div>

                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Receipt Amount</div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.rpt_net_amount | number}}
                    </div>
                  </div>





                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Total Amount: </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.rpt_net_amount | number}}
                    </div>
                  </div>

                  <div class="row">
                    <div class="font-size-16 font-regular col-sm">Created By: </div>
                    <div class="font-size-16 font-bold col-sm">
                      : {{receipt.created_name}}
                    </div>
                  </div>

                </div>
              </div>
            </fieldset>
          </div>
        </mat-card>
      </div>
      <div class="col-6 remove-col-padding" *ngIf="showForm">
        <mat-card class="card-top-form__container card-height-605 card-height-720">
          <div class="row">
            <div class="col-3"></div>
            <div class="col-6">
              <div class="row">
                <div class="col-6">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Receipt Date</mat-label>
                    <input matInput [matDatepicker]="pickerReceipt" placeholder="Choose a date"
                      formControlName="ftr_transaction_date" required>
                    <mat-datepicker-toggle matSuffix [for]="pickerReceipt"></mat-datepicker-toggle>
                    <mat-datepicker #pickerReceipt></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="col-6">
                  <mat-form-field appearance="outline" class="form-field ">
                    <mat-label>Payment Mode</mat-label>
                    <mat-select formControlName="ftr_pay_id" placeholder="Payment Mode"
                      (selectionChange)="setPayAmount($event)" required>
                      <mat-option value="">Please Select</mat-option>
                      <mat-option *ngFor="let mode of payModes" [value]="mode.pay_id">{{mode.pay_name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="col-3"></div>
          </div>
          <div *ngIf="modifyReceiptForm.value.ftr_pay_id === '1'">
            <div class="row">
              <div class="col-3"></div>
              <div class="col-6">
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Amount</mat-label>
                      <!--[readonly]="selectedMode === '1'"-->
                      <input matInput placeholder="Amount" type="number" formControlName="ftr_amount" required>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Remarks</mat-label>
                      <textarea placeholder="Write your message" required formControlName="ftr_remark" matInput
                        rows="4"></textarea>
                    </mat-form-field>
                  </div>
                </div>
                
              </div>
              <div class="col-3">
              </div>
            </div>
          </div>
          <div *ngIf="modifyReceiptForm.value.ftr_pay_id !== '1' && modifyReceiptForm.value.ftr_pay_id !== '2' 
       && modifyReceiptForm.value.ftr_pay_id !== '3' && modifyReceiptForm.value.ftr_pay_id !== ''">
            <div class="row">
              <div class="col-2"></div>
              <div class="col-8">
                <div class="row">
                  <div class="col-6">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Bank Name </mat-label>
                      <mat-select placeholder="Bank Name" formControlName="ftr_bnk_id" required>
                        <mat-option value="">Please Select</mat-option>
                        <mat-option *ngFor="let bank of banks" [value]="bank.bnk_id">{{bank.bank_name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Amount</mat-label>
                      <input matInput placeholder="Amount" type="number" formControlName="ftr_amount" required>
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Transaction Id</mat-label>
                      <input matInput placeholder="Transaction Id" formControlName="ftr_transaction_id" required>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Remarks</mat-label>
                      <textarea placeholder="Write your message" required formControlName="ftr_remark" matInput
                        rows="4"></textarea>
                    </mat-form-field>
                  </div>
                </div>
                
              </div>
              <div class="col-2">
              </div>
            </div>
          </div>
          <div *ngIf="modifyReceiptForm.value.ftr_pay_id === '2'">
            <div class="row">
              <div class="col-6">
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Bank Name </mat-label>
                      <mat-select placeholder="Bank Name" formControlName="ftr_bnk_id" required>
                        <mat-option value="">Please Select</mat-option>
                        <mat-option *ngFor="let bank of banks" [value]="bank.bnk_id">{{bank.bank_name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Amount</mat-label>
                      <input matInput placeholder="Amount" type="number" formControlName="ftr_amount" required>
                    </mat-form-field>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="row margin-bottom-10">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Remarks</mat-label>
                      <textarea matInput placeholder="Write your message" formControlName="ftr_remark" required
                        rows="6"></textarea>
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="modifyReceiptForm.value.ftr_pay_id === '3'">
            <div class="row">
              <div class="col-12">
                <div class="row">
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Cheque No.</mat-label>
                      <input matInput placeholder="Cheque No." formControlName="ftr_cheque_no"
                        oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                        type="number" maxlength="6" required>
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Drawn On</mat-label>
                      <mat-select placeholder="Drawn On" formControlName="ftr_bnk_id" required>
                        <mat-option value="">Please Select</mat-option>
                        <mat-option *ngFor="let bank of allBanks" [value]="bank.tb_id">{{bank.tb_name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Branch</mat-label>
                      <input matInput placeholder="Bank Branch" formControlName="ftr_branch">
                    </mat-form-field>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="row">
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Amount Chargeable</mat-label>
                      <input matInput placeholder="Amount Chargeable" type="number" formControlName="ftr_amount"
                        required>
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Cheque Date</mat-label>
                      <input matInput [matDatepicker]="picker3" placeholder="Choose a date"
                        formControlName="ftr_cheque_date" required>
                      <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                      <mat-datepicker #picker3></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div class="col-6">
                    <mat-form-field appearance="outline" class="form-field">
                      <mat-label>Remarks</mat-label>
                      <textarea placeholder="Write your message" matInput rows="2" required
                        formControlName="ftr_remark"></textarea>
                    </mat-form-field>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-3"></div>
            <div class="col-6">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Reason for change</mat-label>
                <textarea placeholder="Write your message" matInput rows="2" required
                  formControlName="remarks_main"></textarea>
              </mat-form-field>
            </div>
            <div class="col-3"></div>
          </div>
          <div class="row text-center">
            <div class="col-12">
              <button *ngIf="isExist('369')" mat-button class="text-uppercase btn-success" [disabled]="btnDisable"
                (click)="updateReceipt()">submit</button>
              <button *ngIf="isExist('370')" mat-button class="text-uppercase recalulate-invoice-btn btn-spacer"
                (click)="saveAndPrintReceipt()">save & print</button>
              <button mat-button class="text-uppercase btn-danger btn-spacer" (click)="reset()">reset</button>
            </div>
          </div>
        </mat-card>
      </div>
    </div>
  </form>
  <div class="row" *ngIf="ELEMENT_DATA.length > 0">
    <div class="col-12">
      <mat-card class="card-top-title__container">
        <div class="row">
          <div class="col-2 ">
          </div>
          <div class="col-8 ">

            <mat-table  style="width: 95vh;" #table [dataSource]="dataSource"
              matSort>
              <!-- Position Column -->
              <!-- <ng-container matColumnDef="srno">
                <mat-header-cell *matHeaderCellDef mat-sort-header> No. </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{item.srno}} </mat-cell>
              </ng-container> -->
              <!-- Template Name Column -->
              <ng-container matColumnDef="created_date">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Date</mat-header-cell>
                <mat-cell *matCellDef="let item"> {{item.created_date}} </mat-cell>
              </ng-container>
              <!-- Class Column -->
              <ng-container matColumnDef="field_name">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Field </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{item.field_name}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="initial_vale">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Changed From </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{item.initial_vale}} </mat-cell>
              </ng-container>
              <!-- Marks Column -->
              <ng-container matColumnDef="final_vale">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Changed To </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{item.final_vale}} </mat-cell>
              </ng-container>
              <!-- Time Alloted Column -->
              <ng-container matColumnDef="created_by">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Changed By </mat-header-cell>
                <mat-cell *matCellDef="let item" [attr.rowspan]="2"> {{item.created_by}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="remarks">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Remarks </mat-header-cell>
                <mat-cell *matCellDef="let item" [attr.rowspan]="2"> {{item.remarks}} </mat-cell>
              </ng-container>
              <!-- Action Column -->
              <mat-header-row style="width: 95vh;" *matHeaderRowDef="displayedColumns"></mat-header-row>
              <mat-row style="width: 95vh;" *matRowDef="let row; columns: displayedColumns;"></mat-row>
            </mat-table>
            <!-- <mat-paginator #paginator [pageSize]="10" [pageSizeOptions]="[10,20,30]" [showFirstLastButtons]="true" ></mat-paginator> -->

          </div>
          <div class="col-2 ">
          </div>

        </div>
      </mat-card>
    </div>

  </div>
  <div class="my-container">
    <ngx-loading [show]="checkBulkStatus" [config]="{ 
        backdropBorderRadius: '14px',
        backdropBackgroundColour: 'rgba(0,0,0,0.55)'
        }">
    </ngx-loading>
    <span *ngIf="checkBulkStatus" class="text">{{loaderText}}</span>
  </div>